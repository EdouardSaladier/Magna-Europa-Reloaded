on_actions = {
	on_new_term_election = {
		
	}
	
	#Root is exile
	#From is new host
	#FromFrom is old host
	on_host_changed_from_capitulation = {
		effect = {
			#Transfer exile leaders to new host
			From.From = {
				every_army_leader = {
					limit = { is_exiled_leader_from = Root }
					set_nationality = Root.From
				}
			}
		}
	}

	#Root is exile
	#From is old host 
	on_exile_government_reinstated = {
		effect = {
			From = {
				every_army_leader = {
					limit = { is_exiled_leader_from = Root }
					set_nationality = Root
				}
			}
			Root = {
				every_army_leader = {
					limit = { is_exiled_leader_from = Root }
					remove_unit_leader_trait = exiled_leader
					remove_exile_tag = yes
				}
			}
		}
	}

	on_unit_leader_created = {
		effect = {
			if = {
				limit = { is_exiled_leader = yes }
				From.From = { save_event_target_as = exile_nation }
				add_unit_leader_trait = exiled_leader
				
				add_random_trait = {
					old_guard
					brilliant_strategist
					inflexible_strategist
					war_hero
					trait_cautious
					trait_reckless
					media_personality
					harsh_leader
					infantry_officer
					cavalry_officer
					armor_officer
				}

				add_random_trait = {
					organizer
					panzer_leader
					cavalry_leader
					trait_engineer
					infantry_leader
					naval_invader						
					commando
					skilled_staffer
					trickster					
				}

				unit_leader_event = { id = mtg_exile_leader_added.1 }
			}
		}
	}

	#ROOT is winner #FROM gets annexed - This will also fire on_annex
	on_civil_war_end = {
		effect = {
			#End of British Fascist Civil War
			if = {
				limit = {
					original_tag = ENG
					has_government = fascism
					has_completed_focus = ENG_organize_the_blackshirts
				}
				set_country_flag = { flag = won_british_civil_war value = 1 days = 365 }
				country_event = { id = mtg_britain.34 }
			}
			#End of British Fascist Civil War - Democrats won
			if = {
				limit = {
					original_tag = ENG
					has_government = democratic
					FROM = {
						has_government = fascism
						has_completed_focus = ENG_organize_the_blackshirts
					}
				}
				delete_unit_template_and_units = { division_template = "Loyalist Brigade" }
				load_focus_tree = { tree = british_focus keep_completed = no }
				unlock_national_focus = ENG_steady_as_she_goes
				unlock_national_focus = limited_rearmament_focus
				unlock_national_focus = shadow_scheme_focus
				unlock_national_focus = uk_industrial_focus
				unlock_national_focus = royal_ordnance_factories
				if = {
					limit = {
						amount_research_slots > 4
					}
					unlock_national_focus = uk_extra_tech_slot
				}
			}
			# Give back ENG focus tree to Communist ENG if they win a civil war.
			if = {
				limit = {
					original_tag = ENG
					has_government = communism
					has_focus_tree = generic_focus
					FROM = {
						original_tag = ENG
						has_government = communism
					}
				}
				load_focus_tree = { tree = british_focus keep_completed = yes }
			}
			# Give back USA focus tree to CSA if they win a civil war.
			if = {
				limit = {
					original_tag = USA
					has_government = democratic
					FROM = {
						original_tag = USA
						OR = {
							has_government = neutrality
							has_government = fascism
						}
					}
				}
				drop_cosmetic_tag = yes # we are done here
				set_country_flag = democratic_usa_won_civil_war
			}
			#End of British Communist Civil War
			if = {
				limit = {
					original_tag = ENG
					has_government = democratic
					has_completed_focus = ENG_concessions_to_the_trade_unions
				}
				country_event = { id = mtg_britain.56 }
			}
			#End of Imperialist Loyalist civil war
			if = {
				limit = {
					OR = {
						original_tag = CAN
						original_tag = EGY
					}
					has_government = neutrality
					ENG = { has_completed_focus = ENG_appeal_to_imperial_loyalists }
					NOT = { is_subject_of = ENG }
				}
				ENG = { country_event = { id = mtg_britain.113 hours = 6 } }
			}
			if = {
				limit = {
					has_template = "Silver Legion"
				}
				delete_unit_template_and_units = { division_template = "Silver Legion" }
			}
			# Cleaning up anti-exploiter divisions
			delete_unit_template_and_units = { division_template = "Anti-Exploit Punitive Brigade" }
		}
	}

	#ROOT is winner #FROM gets annexed - This fires just before FROM gets annexed, meaning the country and everything it owns still exists. It will also fire on_annex and on_civil_war_end
	on_civil_war_end_before_annexation = {
		effect = {
			#End of British Fascist Civil War - moving the fleet back to the Fascists because they won
			if = {
				limit = {
					original_tag = ENG
					has_government = fascism
					has_completed_focus = ENG_organize_the_blackshirts
				}
				random_other_country = {
					limit = {
						original_tag = ENG
						has_government = democratic
					}
					transfer_navy = { target = ENG }
					every_unit_leader = {
						limit = {
							OR = {
								has_id = 983
								has_id = 984
								has_id = 985
								has_id = 986
								has_id = 987
								has_id = 988
								has_id = 989
								has_id = 990
								has_id = 991
								has_id = 992
							}
						}
						set_nationality = ENG
					}
				}
			}
		}
	}

	#FROM is war target
	on_declare_war = {
		effect = {
			# In case of HOL being declared war on and still having Shell-shocked Spectator of the Great War, remove the spirit
			if = {
				limit = {
					FROM = {
						original_tag = HOL
						OR = {
							has_idea = HOL_shell_shocked_spectator_1
							has_idea = HOL_shell_shocked_spectator_2
							has_idea = HOL_shell_shocked_spectator_3
							has_idea = HOL_shell_shocked_spectator_4
							has_idea = HOL_shell_shocked_spectator_5
						}
					}
				}
				FROM = {
					hidden_effect = {
						remove_ideas = HOL_shell_shocked_spectator_1
						remove_ideas = HOL_shell_shocked_spectator_2
						remove_ideas = HOL_shell_shocked_spectator_3
						remove_ideas = HOL_shell_shocked_spectator_4
						remove_ideas = HOL_shell_shocked_spectator_5
					}
				}
			}
			# In case of HOL being declared war on and still having Aloof Neutrality, remove the spirit
			if = {
				limit = {
					FROM = {
						original_tag = HOL
						has_idea = HOL_aloof_neutrality
					}
				}
				FROM = {
					hidden_effect = {
						remove_ideas = HOL_aloof_neutrality
					}
				}
			}
			# In case of HOL being declared war on and having taken the "Share intelligence" decision, they get a temporary buff to defense and attack
			if = {
				limit = {
					tag = FRA
					NOT = { is_in_faction_with = ENG }
					FROM = { has_country_flag = secret_staff_talks_british_intelligence }
				}
				hidden_effect = {
					FROM = { add_timed_idea = { idea = HOL_shared_intelligence_eng_fra days = 180 } }
				}
			}
			if = {
				limit = {
					tag = GER
					NOT = { is_in_faction_with = ENG }
					FROM = { has_country_flag = secret_staff_talks_british_intelligence }
				}
				hidden_effect = {
					FROM = { add_timed_idea = { idea = HOL_shared_intelligence_eng_ger days = 180 } }
				}
			}
			if = {
				limit = {
					tag = ENG
					NOT = { is_in_faction_with = FRA }
					FROM = { has_country_flag = secret_staff_talks_french_intelligence }
				}
				hidden_effect = {
					FROM = { add_timed_idea = { idea = HOL_shared_intelligence_fra_eng days = 180 } }
				}
			}
			if = {
				limit = {
					tag = GER
					NOT = { is_in_faction_with = FRA }
					FROM = { has_country_flag = secret_staff_talks_french_intelligence }
				}
				hidden_effect = {
					FROM = { add_timed_idea = { idea = HOL_shared_intelligence_fra_ger days = 180 } }
				}
			}
			if = {
				limit = {
					tag = FRA
					NOT = { is_in_faction_with = GER }
					FROM = { has_country_flag = secret_staff_talks_german_intelligence }
				}
				hidden_effect = {
					FROM = { add_timed_idea = { idea = HOL_shared_intelligence_ger_fra days = 180 } }
				}
			}
			if = {
				limit = {
					tag = ENG
					NOT = { is_in_faction_with = GER }
					FROM = { has_country_flag = secret_staff_talks_german_intelligence }
				}
				hidden_effect = {
					FROM = { add_timed_idea = { idea = HOL_shared_intelligence_ger_eng days = 180 } }
				}
			}
			# In case of GER/ENG/FRA going to war they get a minor buff if they shared intelligence
			if = {
				limit = {
					tag = FRA
					NOT = { is_in_faction_with = HOL }
					FROM = { has_country_flag = secret_staff_talks_dutch_intelligence }
				}
				hidden_effect = { FROM = { add_timed_idea = { idea = HOL_shared_intelligence_hol_fra days = 180 } } }
			}
			if = {
				limit = {
					FROM = { tag = FRA }
					FROM = { NOT = { is_in_faction_with = HOL } }
					has_country_flag = secret_staff_talks_french_intelligence
				}
				hidden_effect = { add_timed_idea = { idea = HOL_shared_intelligence_hol_fra days = 180 } }
			}
			if = {
				limit = {
					tag = ENG
					NOT = { is_in_faction_with = HOL }
					FROM = { has_country_flag = secret_staff_talks_dutch_intelligence }
				}
				hidden_effect = { FROM = { add_timed_idea = { idea = HOL_shared_intelligence_hol_eng days = 180 } } }
			}
			if = {
				limit = {
					FROM = { tag = ENG }
					FROM = { NOT = { is_in_faction_with = HOL } }
					has_country_flag = secret_staff_talks_french_intelligence
				}
				hidden_effect = { add_timed_idea = { idea = HOL_shared_intelligence_hol_eng days = 180 } }
			}
			if = {
				limit = {
					tag = GER
					NOT = { is_in_faction_with = HOL }
					FROM = { has_country_flag = secret_staff_talks_dutch_intelligence }
				}
				hidden_effect = { FROM = { add_timed_idea = { idea = HOL_shared_intelligence_hol_ger days = 180 } } }
			}
			if = {
				limit = {
					FROM = { tag = GER }
					FROM = { NOT = { is_in_faction_with = HOL } }
					has_country_flag = secret_staff_talks_french_intelligence
				}
				hidden_effect = { add_timed_idea = { idea = HOL_shared_intelligence_hol_ger days = 180 } }
			}
			# In case of HOL being declared war on and having taken the "draw up shared staff plan" decision, they get a temporary buff to core defense and max entrenchment
			if = {
				limit = {
					OR = {
						tag = FRA
						tag = GER
					}
					NOT = { is_in_faction_with = ENG }
					FROM = { has_country_flag = secret_staff_talks_british_staff_plan }
				}
				hidden_effect = { FROM = { add_timed_idea = { idea = HOL_staff_plan_eng days = 180 } } }
			}
			if = {
				limit = {
					OR = {
						tag = ENG
						tag = GER
					}
					NOT = { is_in_faction_with = FRA }
					FROM = { has_country_flag = secret_staff_talks_french_staff_plan }
				}
				hidden_effect = { FROM = { add_timed_idea = { idea = HOL_staff_plan_fra days = 180 } } }
			}
			if = {
				limit = {
					OR = {
						tag = FRA
						tag = ENG
					}
					NOT = { is_in_faction_with = GER }
					FROM = { has_country_flag = secret_staff_talks_german_staff_plan }
				}
				hidden_effect = { FROM = { add_timed_idea = { idea = HOL_staff_plan_ger days = 180 } } }
			}
			# In case of Turkish civil war with field marshal Ataturk out on the field
			if = { 
        	    limit = { 
        	        original_tag = TUR
        	        has_civil_war = yes
        	        FROM = {
        	            original_tag = TUR
        	            has_civil_war = yes
        	        }
        	    }
        	    hidden_effect = { 
        	        if = { 
        	            limit = {
        	            	FROM = { has_government = neutrality } 
        	            }
        	            every_unit_leader = {
        	                limit = { 
        	                    has_id = 59
        	                }
        	                set_nationality = FROM
        	            }
        	        }
        	    }
        	}
		}
	}	

	on_government_exiled = {
		effect = {
			if = {
				limit = {
					original_tag = HOL
					has_country_flag = HOL_prepared_evacuation_of_gold_reserves_flag
				}
				country_event = { id = mtg_netherlands.63 days = 1 }
			}
		}
	}

	#ROOT = nation being puppeted, FROM = overlord
	on_puppet = {
		effect = {
			#if = { #-------------------------------------> No longer happening (NSB)
			#	limit = {
			#		original_tag = SOV
			#		has_government = communism
			#		has_country_leader = { character = SOV_iosif_stalin }
			#		is_puppet_of = MEX
			#		MEX = {
			#			OR = {
			#				has_country_leader = { ruling_only = yes character = MEX_hernan_laborde }
			#				has_country_leader = { ruling_only = yes character = MEX_leon_trotsky }
			#				has_country_leader = { ruling_only = yes character = MEX_valentin_campa }
			#			}
			#		}
			#	}
			#	SOV = { #TODO william check if works as intended or recreate Trotsky independently, also remove Trotsky from Mexico? What about puppet relationship? Look for another Soviet Trotskyist?
			#		country_event = soviet.28
			#	}
			#}	
		}
	}

	on_startup = {
		effect = {
			# Game Rules - Decolonization
			if = {
				limit = {
					has_game_rule = {
						rule = americas_colonization_status
						option = AMERICAS_DECOLONIZED
					}
				}
				ENG = {
					release = CAN
				}
				ENG = {
					set_autonomy = { target = CAN autonomy_state = autonomy_free }
				}
				CAN = {
					abandon_colony_tag = yes
					transfer_state = 64
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = africa_colonization_status
						option = AFRICA_DECOLONIZED
					}
				}
				FRA = {
					set_autonomy = { target = MOR autonomy_state = autonomy_free }
					set_autonomy = { target = TUN autonomy_state = autonomy_free }
					set_autonomy = { target = MRT autonomy_state = autonomy_free }
					release = ALG
					MOR = { drop_cosmetic_tag = yes }
					TUN = { drop_cosmetic_tag = yes }
					MRT = { drop_cosmetic_tag = yes }
					SYR = { drop_cosmetic_tag = yes }
					LEB = { drop_cosmetic_tag = yes }
					set_autonomy = { target = SYR autonomy_state = autonomy_free }
					set_autonomy = { target = LEB autonomy_state = autonomy_free }
					SYR = {
						puppet = ALW
						puppet = JDZ
					}
				}
				ITA = {
					release = LBA
				}
				ENG = {
					delete_unit = { state = 1889 }
					delete_unit = { state = 1286 }
					delete_unit = { state = 1902 }
					delete_unit = { state = 1285 }
					release = EGY
					set_autonomy = { target = EGY autonomy_state = autonomy_free }
				}
				SPR = {
					delete_unit = { state = 290 }
					release = WES
					release = MOR
				}
			}
			# Game Rules - Fragmentation
			if = {
				limit = {
					has_game_rule = {
						rule = nel_status
						option = NEL_AUTONOMOUS
					}
				}
				USA = {
					release = NEL
					set_autonomy = { target = NEL autonomy_state = autonomy_integrated_puppet }
					set_cosmetic_tag = USA_42
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = nel_status
						option = NEL_INDEPENDENT
					}
				}
				USA = {
					release = NEL
					set_cosmetic_tag = USA_42
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = nfl_status
						option = NFL_INDEPENDENT
					}
				}
				ENG = {
					release = NFL
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = nfl_status
						option = NFL_DOMINION
					}
				}
				ENG = {
					release = NFL
					set_autonomy = { target = NFL autonomy_state = autonomy_dominion }
				NFL = {
					set_cosmetic_tag = NFL_UK
					add_to_tech_sharing_group = commonwealth_research }
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = qbc_status
						option = QBC_AUTONOMOUS
					}
				}
				CAN = {
					release = QBC
					set_autonomy = { target = QBC autonomy_state = autonomy_integrated_puppet }
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = qbc_status
						option = QBC_INDEPENDENT
					}
				}
				CAN = {
					release = QBC
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = eng_fragmentation_status
						option = ENG_FRAGMENTED
					}
				}
				ENG = {
					delete_unit = { state = 116 }
					release = SCO
					release = WLS
					release = NIR
					release = CYP
					set_autonomy = { target = MLT autonomy_state = autonomy_free }
					set_autonomy = { target = EGY autonomy_state = autonomy_free }
					set_autonomy = { target = PAL autonomy_state = autonomy_free }
					set_autonomy = { target = JOR autonomy_state = autonomy_free }
					set_autonomy = { target = KUW autonomy_state = autonomy_free }
					set_autonomy = { target = UAE autonomy_state = autonomy_free }
					set_autonomy = { target = BHR autonomy_state = autonomy_free }
					set_autonomy = { target = QAT autonomy_state = autonomy_free }
					set_autonomy = { target = CAN autonomy_state = autonomy_free }
					remove_from_faction = MLT
					remove_from_faction = EGY
					remove_from_faction = PAL
					remove_from_faction = JOR
					remove_from_faction = KUW
					remove_from_faction = UAE
					remove_from_faction = BHR
					remove_from_faction = QAT
					remove_from_faction = CAN
					set_cosmetic_tag = ENG_england
					set_global_flag = ENG_became_england
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = eng_fragmentation_status
						option = ENG_UTTERLY_FRAGMENTED
					}
				}
				ENG = {
					release = CYP
					release = KER
					release = ESX
					release = SSX
					release = KNT
					release = WSX
					release = MER
					release = EAG
					release = YOR
					release = CMB
					release = LCS
					release = NRT
					release = LND
					release = EGY
					release = SHT
					release = ORK
					release = SCO
					release = WLS
					release = NIR
					882 = { add_core_of = SPR }
					release = SPR
					release = NFL
					set_autonomy = { target = MLT autonomy_state = autonomy_free }
					set_autonomy = { target = EGY autonomy_state = autonomy_free }
					set_autonomy = { target = PAL autonomy_state = autonomy_free }
					set_autonomy = { target = JOR autonomy_state = autonomy_free }
					set_autonomy = { target = KUW autonomy_state = autonomy_free }
					set_autonomy = { target = UAE autonomy_state = autonomy_free }
					set_autonomy = { target = BHR autonomy_state = autonomy_free }
					set_autonomy = { target = QAT autonomy_state = autonomy_free }
					set_autonomy = { target = CAN autonomy_state = autonomy_free }
					set_autonomy = { target = JER autonomy_state = autonomy_free }
					set_autonomy = { target = GUE autonomy_state = autonomy_free }
					set_autonomy = { target = ISM autonomy_state = autonomy_free }
					remove_from_faction = MLT
					remove_from_faction = EGY
					remove_from_faction = PAL
					remove_from_faction = JOR
					remove_from_faction = KUW
					remove_from_faction = UAE
					remove_from_faction = BHR
					remove_from_faction = QAT
					remove_from_faction = CAN
					remove_from_faction = JER
					remove_from_faction = GUE
					remove_from_faction = ISM
				}
				LND = {
					annex_country = {
						target = ENG
					}
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = rom_fragmentation_status
						option = ROM_FRAGMENTED
					}
				}
				ROM = {
					release = WLC
					release = MOL
					release = TRA
					transfer_units_fraction = {
						target = WLC
						size = 0.4
					}
					transfer_units_fraction = {
						target = MOL
						size = 0.3
					}
					transfer_units_fraction = {
						target = TRA
						size = 0.3
					}
				}
				WLC = {
					change_tag_from = ROM
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = rom_fragmentation_status
						option = ROM_VERY_FRAGMENTED
					}
				}
				ROM = {
					release = BUC
					release = SZE
					release = DOB
					release = GAG
					release = BDZ
					release = BNT
					release = OLT
					release = MUN
					release = BSR
					release = MOL
					release = CRS
					release = MRM
					release = TRA
					transfer_units_fraction = {
						target = MUN
						size = 0.1
					}
					transfer_units_fraction = {
						target = OLT
						size = 0.1
					}
					transfer_units_fraction = {
						target = DOB
						size = 0.1
					}
					transfer_units_fraction = {
						target = MOL
						size = 0.1
					}
					transfer_units_fraction = {
						target = BSR
						size = 0.1
					}
					transfer_units_fraction = {
						target = BUC
						size = 0.1
					}
					transfer_units_fraction = {
						target = BDZ
						size = 0.1
					}
					transfer_units_fraction = {
						target = TRA
						size = 0.1
					}
					transfer_units_fraction = {
						target = BNT
						size = 0.1
					}
					transfer_units_fraction = {
						target = SZE
						size = 0.1
					}
				}
				WLC = {
					change_tag_from = ROM
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = fra_fragmentation_status
						option = FRA_FRAGMENTED
					}
				}
				FRA = {
					release = CAT
					release = NAV
					release = ALS
					release = BRI
					release = COR
				}
				
			}
			if = {
				limit = {
					has_game_rule = {
						rule = fra_fragmentation_status
						option = FRA_REGIONS
					}
				}
				FRA = {
					release = CAT
					release = NAV
					release = ALS
					release = LOR
					release = CMP
					release = PIC
					release = ATI
					release = LYO
					release = BGN
					release = SAV
					release = DAU
					release = PRV
					release = AVG
					release = AQT
					release = POI
					release = LMS
					release = ORL
					release = ANJ
					release = NMD
					release = OCC
					release = BRI
					release = COR
					if = {
						limit = {
							has_game_rule = {
								rule = bel_fragmentation_status
								option = DEFAULT
							}
						}
						466 = { add_core_of = BEL }
						1342 = { add_core_of = BEL }
						2333 = { add_core_of = BEL }
						release = BEL
					}
					else_if = {
						limit = {
							has_game_rule = {
								rule = bel_fragmentation_status
								option = BEL_DISSOLVED
							}
						}
						release = FLA
						release = WLN
						
					}
					else_if = {
						limit = {
							has_game_rule = {
								rule = bel_fragmentation_status
								option = BEL_FRAGMENTED
							}
						}
						1342 = { add_core_of = FLA }
						release = FLA
						release = HNT
						
					}
					set_autonomy = { target = MOR autonomy_state = autonomy_free }
					set_autonomy = { target = MRT autonomy_state = autonomy_free }
					MOR = { drop_cosmetic_tag = yes }
					TUN = { drop_cosmetic_tag = yes }
					MRT = { drop_cosmetic_tag = yes }
					SYR = { drop_cosmetic_tag = yes }
					LEB = { drop_cosmetic_tag = yes }
					set_autonomy = { target = TUN autonomy_state = autonomy_free }
					set_autonomy = { target = SYR autonomy_state = autonomy_free }
					set_autonomy = { target = LEB autonomy_state = autonomy_free }
					SYR = {
						puppet = ALW
						puppet = JDZ
					}
					set_cosmetic_tag = FRA_ile_de_france
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = spr_fragmentation_status
						option = SPR_EU4
					}
				}
				SPR = {
					release = NAV
					release = GLC
					every_state = {
						limit = {
							OR = {
								is_core_of = CAT
								is_core_of = VAL
								is_core_of = BAL
								is_core_of = SRD
							}
						}
						add_core_of = ARA
						transfer_state_to = ARA
					}
					every_state = {
						limit = {
							OR = {
								state = 1115
								state = 1103
								state = 1083
								state = 1086
								state = 893
								state = 1852
							}
						}
						transfer_state_to = ADU
					}
					set_politics = {
						ruling_party = neutrality
						elections_allowed = yes
					}
					set_political_party = {
						ideology = neutrality
						popularity = 85
					}
					transfer_units_fraction = {
						target = CAT
						size = 0.2
					}
					transfer_units_fraction = {
						target = GLC
						size = 0.025
					}
					transfer_units_fraction = {
						target = NAV
						size = 0.025
					}
					transfer_units_fraction = {
						target = ADU
						size = 0.2
					}
				}
				SPA = {
					set_cosmetic_tag = SPR_nationalist_castille
				}
				SPB = {
					set_cosmetic_tag = SPR_carlist_castille
				}
				SPC = {
					set_cosmetic_tag = SPR_anarchist_castille
				}
				SPD = {
					set_cosmetic_tag = SPR_republican_castille
				}
				CAT = {
					set_politics = {
						ruling_party = neutrality
						elections_allowed = no
					}
					set_political_party = {
						ideology = neutrality
						popularity = 85
					}
					set_cosmetic_tag = CAT_aragon
				}
				NAV = {
					set_politics = {
						ruling_party = neutrality
					}
					set_political_party = {
						ideology = neutrality
						popularity = 85
					}
				}
				GLC = {
					set_politics = {
						ruling_party = neutrality
					}
					set_political_party = {
						ideology = neutrality
						popularity = 85
					}
				}
				ADU = {
					set_country_flag = country_formed_andalusia_flag
				}
				set_global_flag = form_andalusia_flag
				every_state = {
					limit = {
						OR = {
							is_mainland_spain_vanilla_groups = yes
							is_balearic_group = yes
						}
					}
					add_core_of = ADU
					add_core_of = SPR
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = spr_fragmentation_status
						option = SPR_FRAGMENTED
					}
				}
				SPR = {
					release = GLC
					release = ATR
					release = NAV
					release = CAT
					release = ARA
					release = BAL
					release = ADU
					release = VAL
					release = MOR
					release = CNR
					set_cosmetic_tag = SPR_castille
					diplomatic_relation = {
						country = ADR
						relation = guarantee
						active = no
					}
				}
				SPA = {
					set_cosmetic_tag = SPR_nationalist_castille
				}
				SPB = {
					set_cosmetic_tag = SPR_carlist_castille
				}
				SPC = {
					set_cosmetic_tag = SPR_anarchist_castille
				}
				SPD = {
					set_cosmetic_tag = SPR_republican_castille
				}
				VAL = {
					every_core_state = {
						add_core_of = CAT
					}
				}
				if = {
					limit = {
						OCC = {
							exists = yes
						}
					}
					CAT = { transfer_state = 871 }
				}	
				CAT = {
					annex_country = {
						target = VAL
					}
					annex_country = {
						target = BAL
					}
					set_cosmetic_tag = CAT_GREATER
					give_guarantee = ADR
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = ger_fragmentation_status
						option = GER_1870_FRAGMENTED
					}
				}
				GER = {
					every_controlled_state = {
						set_demilitarized_zone = no
					}
					transfer_units_fraction = {
						target = LIE
						size = 1
					}
					release = PRE
					release = SXC
					release = BAY
					release = BDN
					release = WUR
					release = SAX
					release = MKS
					release = MKW
					release = HES
					release = WDK
					release = LIP
					release = ANH
					release = SCL
					release = OLD
					release = BRE
					release = HAM
					release = BRW
					release = LBK
					release = SXW
					release = SXA
					release = SXM
					release = RGR
					release = RGE
					release = SRU
					release = SSD
				}
				LIE = {
					transfer_units_fraction = {
						target = BAY
						size = 0.2
					}
					transfer_units_fraction = {
						target = SAX
						size = 0.1
					}
					transfer_units_fraction = {
						target = PRE
						size = 1
					}
				}
				PRE = {
					change_tag_from = GER
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = ger_fragmentation_status
						option = GER_FRAGMENTED
					}
				}
				GER = {
					every_controlled_state = {
						set_demilitarized_zone = no
					}
					release = ESP
					release = WPR
					release = POM
					release = THU
					release = BAY
					release = SIL
					release = BRN
					release = BDN
					release = HOZ
					release = WUR
					release = SAX
					release = SXP
					release = ANH
					release = WSP
					release = MKS
					release = MKW
					release = HES
					release = HSN
					release = NAS
					release = HSK
					release = RHN
					release = WDK
					release = WST
					release = LIP
					release = SCL
					release = SAA
					release = OLD
					release = BRE
					release = HAM
					release = HAN
					release = BRW
					release = SHL
					release = LBK
					transfer_units_fraction = {
						target = LIE
						size = 1
					}
				}
				LIE = {
					transfer_units_fraction = {
						target = BRN
						size = 1
					}
				}
				BRN = {
					change_tag_from = GER
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = ger_fragmentation_status
						option = GER_FRAGMENTED_LARGE
					}
				}
				GER = {
					every_controlled_state = {
						set_demilitarized_zone = no
					}
					release = ESP
					release = WPR
					release = POM
					release = THU
					release = BPA
					release = BAY
					release = SIL
					release = BRN
					release = BDN
					release = HOZ
					release = WUR
					release = SAX
					release = SXP
					release = ANH
					release = WSP
					release = MEK
					release = HES
					release = HSN
					release = NAS
					release = HSK
					release = RHN
					release = WDK
					release = WST
					release = LIP
					release = SCL
					release = SAA
					release = OLD
					release = BRE
					release = HAM
					release = HAN
					release = BRW
					release = SHL
					release = LBK
					transfer_units_fraction = {
						target = LIE
						size = 1
					}
				}
				LIE = {
					transfer_units_fraction = {
						target = BRN
						size = 1
					}
				}
				WUR = {
					annex_country = {
						target = HOZ
						transfer_troops = no
					}
					every_controlled_state = {
						add_core_of = WUR
					}
				}
				HES = {
					annex_country = {
						target = HSN
						transfer_troops = no
					}
					annex_country = {
						target = WDK
						transfer_troops = no
					}
					transfer_state = 2573
					every_controlled_state = {
						add_core_of = HES
					}
				}
				RHN = {
					annex_country = {
						target = SAA
						transfer_troops = no
					}
					annex_country = {
						target = BPA
						transfer_troops = no
					}
					transfer_state = 1758
					every_controlled_state = {
						add_core_of = RHN
					}
				}
				WST = {
					annex_country = {
						target = LIP
						transfer_troops = no
					}
					annex_country = {
						target = SCL
						transfer_troops = no
					}
					transfer_state = 2563
					every_controlled_state = {
						add_core_of = WST
					}
				}
				PRE = {
					annex_country = {
						target = ESP
						transfer_troops = no
					}
					annex_country = {
						target = WPR
						transfer_troops = no
					}
				}
				BRN = {
					change_tag_from = GER
				}
				SHL = {
					transfer_state = 1704
					transfer_state = 1755
					transfer_state = 1759
					transfer_state = 2570
					transfer_state = 1702
					every_controlled_state = {
						add_core_of = SHL
					}
				}
				THU = {
					transfer_state = 1689
					transfer_state = 2533
					transfer_state = 440
					transfer_state = 1679
					transfer_state = 1683
					transfer_state = 1682
					every_controlled_state = {
						add_core_of = THU
					}
				}
				SXP = {
					annex_country = {
						target = ANH
						transfer_troops = no
					}
					transfer_state = 2551
					transfer_state = 392
					every_controlled_state = {
						add_core_of = SXP
					}
				}
				HAN = {
					annex_country = {
						target = OLD
						transfer_troops = no
					}
					annex_country = {
						target = BRE
						transfer_troops = no
					}
					annex_country = {
						target = BRW
						transfer_troops = no
					}
					transfer_state = 2571
					transfer_state = 2565
					every_controlled_state = {
						add_core_of = HAN
					}
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = yug_fragmentation_status
						option = YUG_FRAGMENTED
					}
				}
				YUG = {
					release = SLV
					release = BOS
					release = MAC
					release = KOS
					release = SER
					transfer_units_fraction = {
						target = SER
						size = 1
					}
					release = CRO
					release = MNT
				}
				SER = {
					change_tag_from = YUG
				}
				#SER = {
				#	country_event = DOD_yugoslavia.166 # MM: Commented since it is a NON-EXISTENT EVENT
				#}
				CRO = {
					set_political_party = {
						ideology = democratic
						popularity = 50
					}
					set_politics = {
						ruling_party = democratic
						last_election = "1936.1.1"
						election_frequency = 48
						elections_allowed = yes
					}
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = yug_fragmentation_status
						option = YUG_VERY_FRAGMENTED
					}
				}
				YUG = {
					release = SDZ
					release = DLM
					release = BNT
					release = VJV
					release = SRP
					release = KRJ
					release = HZB
					release = WBS
					release = PKR
					release = STR
					release = KRT
					release = SLV
					release = UZC
					release = BOS
					release = MAC
					release = KOS
					release = SER
					transfer_units_fraction = {
						target = SER
						size = 1
					}
					release = CRO
					release = MNT
				}
				SER = {
					change_tag_from = YUG
				}
				SLV = { set_cosmetic_tag = SLV_carniola }
				#SER = {
				#	country_event = DOD_yugoslavia.166 # MM: Commented since it is a NON-EXISTENT EVENT
				#}
				CRO = {
					set_political_party = {
						ideology = democratic
						popularity = 50
					}
					set_politics = {
						ruling_party = democratic
						last_election = "1936.1.1"
						election_frequency = 48
						elections_allowed = yes
					}
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = sov_fragmentation_status
						option = SOV_FRAGMENTED
					}
				}
				SOV = {
					release = BLR
					release = UKR
					release = TCC
					release = KAZ
					release = UZB
					release = TMS
					set_autonomy = { target = BLR autonomy_state = autonomy_integrated_puppet }
					set_autonomy = { target = UKR autonomy_state = autonomy_integrated_puppet }
					set_autonomy = { target = TCC autonomy_state = autonomy_integrated_puppet }
					set_autonomy = { target = KAZ autonomy_state = autonomy_integrated_puppet }
					set_autonomy = { target = UZB autonomy_state = autonomy_integrated_puppet }
					set_autonomy = { target = TMS autonomy_state = autonomy_integrated_puppet }
					# retire_country_leader = yes
                    set_cosmetic_tag = SOV_russia
                    set_global_flag = SOV_became_russia
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = sov_fragmentation_status
						option = SOV_UTTERLY_FRAGMENTED
					}
				}
				SOV = {
					release = NOV
					release = TSN
					release = PLD
					release = VLH
					release = ZAP
					release = DNB
					release = SLB
					release = CRZ
					release = DKR
					release = CRI
					every_state = {
						limit = {
							is_core_of = ZAP
							is_core_of = ODS
							region = 100
						}
						transfer_state_to = ODS
					}
					release = UKR
					release = IGR
					release = BLR
					release = KAR
					release = ABK
					release = SOA
					release = ADJ
					release = NGK
					release = NKH
					release = BAK
					release = GEO
					release = AZR
					release = ARM
					release = CIN
					release = DAG
					release = NOA
					release = KBK
					release = KAL
					release = KKP
					release = KHI
					release = UZB
					release = KYR
					release = TMS
					release = KAZ
					release = VGE
					release = TAT
					release = BSK
					release = NEN
					release = KOM
					release = UDM
					release = MEL
					release = CHU
					release = TSN
					release = KRC
					release = TRK
					release = SOC
					release = VRC
					release = VRS
					release = NVR
					release = ADY
					release = KUB
					release = PEM
					release = AKG
					release = SAP
					release = AKN
					release = DON
					release = MRD
					# retire_country_leader = yes
                    set_cosmetic_tag = SOV_russia
                    set_global_flag = SOV_became_russia
				}
				KUB = { puppet = ADY }
			}
			if = {
				limit = {
					has_game_rule = {
						rule = ita_fragmentation_status
						option = ITA_FRAGMENTED_1815
					}
				}
				ITA = {
					delete_unit_template_and_units = {
						division_template = "Camicie Nere"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Coloniale"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Indigena Irregolare"
					}
					delete_unit_template_and_units = {
						division_template = "Truppe Irregolari a Cavallo"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Ascari Libica"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Ascari Eritrea"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Ascari Somala"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Irregolare Libica"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Irregolare Eritrea"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Irregolare Somala"
					}
					every_state = {
						limit = {
							OR = {
								is_core_of = PIE
								is_core_of = LIG
								is_core_of = AOS
								is_core_of = SRD
								is_core_of = SAV
								is_core_of = NZA
								state = 1363
								state = 2393
							}
						}
						add_core_of = PIE
					}
					PIE = { set_cosmetic_tag = PIE_SRD_UNION }
					release = PIE
					every_state = {
						limit = {
							OR = {
								is_core_of = FRI
								is_core_of = VNT
								is_core_of = LOM
							}
							NOT = { state = 1616 state = 2970 state = 1533 state = 2536 }
						}
						add_core_of = LOM
					}
					1616 = { transfer_state_to = AUS add_core_of = AUS }
					LOM = { set_cosmetic_tag = LOM_VEN_UNIFIED }
					every_state = {
						limit = {
							OR = {
								is_core_of = SIC
								is_core_of = CAL
								is_core_of = LUC
								is_core_of = NAP
								is_core_of = PUG
								is_core_of = MLS
								is_core_of = ABR
							}
							NOT = { state = 2914 }
						}
						add_core_of = NAP
					}
					release = ALB
					release = NAP
					NAP = { set_cosmetic_tag = NAP_KTS_UNIFIED }
					every_owned_state = {
						limit = { is_core_of = TIR }
						add_core_of = AUS
					}
					release = AUS
					release = GOR
					release = LOM
					2558 = { remove_core_of = PRM remove_core_of = MCR add_core_of = TUS }
					2556 = { remove_core_of = MCR }
					2883 = { add_core_of = TUS }
					release = MCR
					release = MDN
					release = LCC
					release = TUS
					release = PRM
					release = LBA
					release = IST
					release = TST
					MDN = {
						if = {
							limit = { has_dlc = "No Step Back" }
							set_autonomy = { target = MCR autonomy_state = autonomy_personal_union }
							else_if = {
								limit = { has_dlc = "Together for Victory" }
								set_autonomy = { target = MCR autonomy_state = autonomy_dominion }
							}
							else = {
								puppet = MCR
							}
						}
					}
					TUS = {
						if = {
							limit = { has_dlc = "No Step Back" }
							set_autonomy = { target = LCC autonomy_state = autonomy_personal_union }
							else_if = {
								limit = { has_dlc = "Together for Victory" }
								set_autonomy = { target = LCC autonomy_state = autonomy_dominion }
							}
							else = {
								puppet = LCC
							}
							LCC = {
								create_country_leader = {
									name = "Pietro Ferdinando d'Asburgo-Lorena"
									desc = ""
									picture = "gfx/leaders/TUS/Portrait_TUS_Pietro_Ferdinando.png"
									expire = "1960.1.1"
									ideology = despotism
									traits = {}
								}
							}
						}
					}
					every_owned_state = {
						limit = { OR = { is_core_of = SLV is_core_of = CRO } }
						if = {
							limit = { has_game_rule = { rule = yug_fragmentation_status option = DEFAULT } }
							add_core_of = YUG
							ITA = { release = YUG }
						}
						else_if = {
							limit = { has_game_rule = { rule = yug_fragmentation_status option = YUG_FRAGMENTED } }
							ITA = { release = SLV release = CRO }
						}
						else = {
							ITA = { release = SLV release = DLM }
						}
					}
					every_state = {
						limit = { is_owned_by = ITA }
						transfer_state_to = VAT
						add_core_of = VAT
					}
					VAT = { set_cosmetic_tag = papal_states set_capital = { state = 876 } give_guarantee = SMR }
					transfer_units_fraction = {
						target = LOM
						size = 0.2
					}
					transfer_units_fraction = {
						target = VAT
						size = 0.1
					}
					transfer_units_fraction = {
						target = TUS
						size = 0.1
					}
					transfer_units_fraction = {
						target = PIE
						size = 0.3
					}
					transfer_units_fraction = {
						target = NAP
						size = 0.3
					}
					
					every_core_state = { remove_core_of = ITA }
					
					1554 = {
						transfer_state_to = GRE
					}
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = ita_fragmentation_status
						option = ITA_FRAGMENTED
					}
				}
				ITA = {
					delete_unit_template_and_units = {
						division_template = "Camicie Nere"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Coloniale"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Indigena Irregolare"
					}
					delete_unit_template_and_units = {
						division_template = "Truppe Irregolari a Cavallo"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Ascari Libica"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Ascari Eritrea"
					}
					delete_unit_template_and_units = {
						division_template = "Divisione Ascari Somala"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Irregolare Libica"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Irregolare Eritrea"
					}
					delete_unit_template_and_units = {
						division_template = "Banda Irregolare Somala"
					}
					every_state = {
						limit = {
							OR = {
								is_core_of = PIE
								is_core_of = LIG
								is_core_of = AOS
								is_core_of = SRD
								is_core_of = SAV
								is_core_of = NZA
								state = 1363
								state = 2393
							}
						}
						add_core_of = PIE
					}
					PIE = { set_cosmetic_tag = PIE_SRD_UNION }
					release = PIE
					every_state = {
						limit = {
							OR = {
								is_core_of = FRI
								is_core_of = VNT
								is_core_of = LOM
							}
							NOT = { state = 1616 state = 2970 state = 1533 state = 2536 }
						}
						add_core_of = LOM
					}
					1616 = { transfer_state_to = AUS add_core_of = AUS }
					LOM = {
						set_cosmetic_tag = LOM_VEN_UNIFIED
					}
					every_state = {
						limit = {
							OR = {
								is_core_of = SIC
								is_core_of = CAL
								is_core_of = LUC
								is_core_of = NAP
								is_core_of = PUG
								is_core_of = MLS
								is_core_of = ABR
							}
							NOT = { state = 2914 }
						}
						add_core_of = NAP
					}
					release = ALB
					release = NAP
					NAP = {
						set_cosmetic_tag = NAP_KTS_UNIFIED
					}
					every_owned_state = {
						limit = { is_core_of = TIR }
						add_core_of = AUS
					}
					2883 = { add_core_of = TUS }
					release = AUS
					release = GOR
					release = LOM
					release = PRM
					release = MDN
					release = TUS
					release = LBA
					release = IST
					release = TST
					every_owned_state = {
						limit = { OR = { is_core_of = SLV is_core_of = CRO } }
						if = {
							limit = { has_game_rule = { rule = yug_fragmentation_status option = DEFAULT } }
							add_core_of = YUG
							ITA = { release = YUG }
						}
						else_if = {
							limit = { has_game_rule = { rule = yug_fragmentation_status option = YUG_FRAGMENTED } }
							ITA = { release = SLV release = CRO }
						}
						else = {
							ITA = { release = SLV release = DLM }
						}
					}
					every_owned_state = {
						transfer_state_to = VAT
						add_core_of = VAT
					}
					VAT = { set_cosmetic_tag = papal_states set_capital = { state = 876 } give_guarantee = SMR }
					transfer_units_fraction = {
						target = LOM
						size = 0.2
					}
					transfer_units_fraction = {
						target = VAT
						size = 0.1
					}
					transfer_units_fraction = {
						target = TUS
						size = 0.1
					}
					transfer_units_fraction = {
						target = PIE
						size = 0.3
					}
					transfer_units_fraction = {
						target = NAP
						size = 0.3
					}
					
					every_core_state = { remove_core_of = ITA }
					
					1554 = {
						transfer_state_to = GRE
					}

				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = ita_fragmentation_status
						option = ITA_REGIONS
					}
				}
				ITA = {
					release = PIE
					release = AOS
					release = LIG
					release = LOM
					if = {
						limit = {
							NOT = {
								has_game_rule = {
									rule = aus_fragmentation_status
									option = AUS_FRAGMENTED
								}
							}
						}
						every_owned_state = {
							limit = { is_core_of = TIR }
							add_core_of = SUT
						}
						release = SUT
					}
					release = VNT
					release = TIR
					release = FRI
					1476 = { add_core_of = JUL }
					1534 = { add_core_of = JUL }
					release = JUL
					every_state = {
						limit = { is_core_of = MCR }
						add_core_of = TUS
					}
					release = TUS
					every_state = {
						limit = {
							OR = {
								is_core_of = MDN
								is_core_of = PRM
								is_core_of = FRR
								is_core_of = RMG
							}
							NOT = { is_core_of = MCR }
						}
						add_core_of = BLG
					}
					release = BLG
					BLG = { set_cosmetic_tag = EMR_UNIFIED }
					release = MAR
					release = UMB
					release = LAZ
					release = SRD
					release = ABR
					release = MLS
					release = NAP
					release = ALB
					release = PUG
					release = LUC
					release = CAL
					release = SIC
					release = LBA
					transfer_units_fraction = {
						target = LOM
						size = 0.20
					}
					transfer_units_fraction = {
						target = NAP
						size = 0.15
					}
					transfer_units_fraction = {
						target = SIC
						size = 0.15
					}
					transfer_units_fraction = {
						target = PIE
						size = 0.075
					}
					transfer_units_fraction = {
						target = VNT
						size = 0.075
					}
					transfer_units_fraction = {
						target = TUS
						size = 0.075
					}
					transfer_units_fraction = {
						target = BLG
						size = 0.05
					}
					transfer_units_fraction = {
						target = PUG
						size = 0.05
					}
					transfer_units_fraction = {
						target = LAZ
						size = 0.05
					}
					transfer_units_fraction = {
						target = CAL
						size = 0.025
					}
					transfer_units_fraction = {
						target = SRD
						size = 0.025
					}
					transfer_units_fraction = {
						target = ABR
						size = 0.025
					}
					transfer_units_fraction = {
						target = MAR
						size = 0.025
					}
					transfer_units_fraction = {
						target = LIG
						size = 0.025
					}
					release = GRE
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = ita_fragmentation_status
						option = ITA_MORE_FRAGMENTATION
					}
				}
				ITA = {
					release = KRT
					release = AOS
					release = PIE
					release = LIG
					release = PAV
					release = MTV
					2849 = { remove_claim_by = LDN add_core_of = LDN }
					2905 = { remove_claim_by = LDN add_core_of = LDN }
					release = LDN
					release = FIU
					release = LBN
					release = IST
					release = TST
					release = GOR
					release = FRI
					2970 = { transfer_state_to = FRI }
					release = VNT
					release = LOM
					release = BLG
					release = TUS
					TUS = { set_cosmetic_tag = FLO set_country_flag = TUS_florence_flag release = LCC release = PIS release = SNA set_politics = { ruling_party = democratic } add_popularity = { ideology = democratic popularity = 0.4 } }
					release = MCR
					release = MDN
				#	MDN = {
				#		if = {
				#			limit = { has_dlc = "No Step Back" }
				#			set_autonomy = { target = MCR autonomy_state = autonomy_personal_union }
				#			else_if = {
				#				limit = { has_dlc = "Together for Victory" }
				#				set_autonomy = { target = MCR autonomy_state = autonomy_dominion }
				#			}
				#			else = {
				#				puppet = MCR
				#			}
				#		}
				#	}
					release = PRM
					release = FRR
					release = BLG
					release = RMG
					release = MAR
					release = UMB
					release = ABR
					release = SRD
					release = SIC
					release = NAP
					release = MLS
					release = ALB
					release = PUG
					release = LAZ
					LAZ = { give_guarantee = VAT }
					release = LUC
					release = CAL
					if = {
						limit = { YUG = { owns_state = 743 } }
						1485 = { add_core_of = YUG }
						2901 = { add_core_of = YUG }
						release = YUG
					}
					else_if = {
						limit = { SLV = { owns_state = 743 } }
						release = SLV
					}
					if = {
						limit = { YUG = { owns_state = 1988 } }
						1476 = { add_core_of = YUG }
						1534 = { add_core_of = YUG }
						release = YUG
					}
					else_if = {
						limit = { CRO = { owns_state = 1988 } }
						release = CRO
					}
					else_if = {
						limit = { DLM = { owns_state = 1988 } }
						release = DLM
					}
					if = {
						limit = {
							NOT = {
								has_game_rule = {
									rule = aus_fragmentation_status
									option = AUS_FRAGMENTED
								}
							}
						}
						every_owned_state = {
							limit = { is_core_of = TIR }
							add_core_of = SUT
						}
						release = SUT
					}
					release = TIR
					transfer_units_fraction = {
						target = LOM
						size = 0.20
					}
					transfer_units_fraction = {
						target = NAP
						size = 0.15
					}
					transfer_units_fraction = {
						target = SIC
						size = 0.15
					}
					transfer_units_fraction = {
						target = PIE
						size = 0.075
					}
					transfer_units_fraction = {
						target = VNT
						size = 0.075
					}
					transfer_units_fraction = {
						target = TUS
						size = 0.075
					}
					transfer_units_fraction = {
						target = BLG
						size = 0.05
					}
					transfer_units_fraction = {
						target = PUG
						size = 0.05
					}
					transfer_units_fraction = {
						target = LAZ
						size = 0.05
					}
					transfer_units_fraction = {
						target = CAL
						size = 0.025
					}
					transfer_units_fraction = {
						target = SRD
						size = 0.025
					}
					transfer_units_fraction = {
						target = ABR
						size = 0.025
					}
					transfer_units_fraction = {
						target = MAR
						size = 0.025
					}
					transfer_units_fraction = {
						target = LIG
						size = 0.025
					}
					release = LBA
					release = GRE
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = aus_fragmentation_status
						option = AUS_FRAGMENTED
					}
				}
				AUS = {
					release = VOR
					release = TIR
					release = SLZ
					release = KRT
					release = STR
					release = BUR
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = swi_fragmentation_status
						option = SWI_PARTITIONED
					}
				}
				if = {
					limit = {
						has_game_rule = {
							rule = fra_fragmentation_status
							option = FRA_REGIONS
						}
					}
					every_state = {
						limit = {
							is_core_of = RMD
						}
						add_core_of = BGN
					}
				}
				else_if = {
					limit = {
						NOT = {
							has_game_rule = {
								rule = fra_fragmentation_status
								option = FRA_REGIONS
							}
						}
					}
					every_state = {
						limit = {
							is_core_of = RMD
						}
						add_core_of = FRA
					}
				}
				if = {
					limit = {
						has_game_rule = {
							rule = ita_fragmentation_status
							option = DEFAULT
						}
					}
					every_state = {
						limit = {
							is_core_of = LOM
							is_core_of = SWI
						}
						add_core_of = ITA
					}
				}
				if = {
					limit = {
						has_game_rule = {
							rule = ger_fragmentation_status
							option = DEFAULT
						}
					}
					every_state = {
						limit = {
							is_core_of = SWI
							NOT = { 
								is_core_of = RMD 
								is_core_of = LOM
								state = 1447
							}
						}
						add_core_of = GER
					}
				}
				SWI = {
					every_owned_state = {
						delete_unit = { 
							state = PREV 
							disband = no 
						}
					}
					release = FRA
					release = BGN
					release = ITA
					release = LOM
					release = GER
					release = GRS
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = swi_fragmentation_status
						option = SWI_FRAGMENTED
					}
				}
				SWI = {
					release = VLS
					release = RMD
					release = GRS
					release = TIC
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = bel_fragmentation_status
						option = BEL_DISSOLVED
					}
				}
				BEL = {
					if = {
						limit = { has_game_rule = { rule = ger_fragmentation_status option = DEFAULT } }
						485 = { add_core_of = GER set_demilitarized_zone = yes }
						release = GER
					}
					else_if = {
						limit = { has_game_rule = { rule = ger_fragmentation_status option = GER_1870_FRAGMENTED } }
						release = PRE
					}
					else = {
						release = RHN
					}
					2969 = { add_core_of = FLA }
					release = FLA
					release = WLN
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = bel_fragmentation_status
						option = BEL_PARTITIONED
					}
				}
				BEL = {
					if = {
						limit = { has_game_rule = { rule = ger_fragmentation_status option = DEFAULT } }
						485 = { add_core_of = GER set_demilitarized_zone = yes }
						release = GER
					}
					else_if = {
						limit = { has_game_rule = { rule = ger_fragmentation_status option = GER_1870_FRAGMENTED } }
						release = PRE
					}
					else = {
						release = RHN
					}
					2969 = { transfer_state_to = HOL add_core_of = HOL }
					if = {
						limit = {
							has_game_rule = {
								rule = hol_fragmentation_status
								option = DEFAULT
							}
						}
						every_owned_state = {
							limit = { is_core_of = FLA }
							transfer_state_to = HOL
						}
					}
					else = {
						release = BRB
						release = LIM
						release = FLA
					}
					if = {
						limit = {
							has_game_rule = {
								rule = fra_fragmentation_status
								option = FRA_REGIONS
							}
						}
						release = HNT
						release = NMR
						release = LEG
						500 = { add_core_of = LUX }
						2368 = { add_core_of = LUX }
						release = LUX
					}
					else = {
						every_owned_state = {
							limit = { is_core_of = WLN }
							transfer_state_to = FRA
						}
					}
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = bel_fragmentation_status
						option = BEL_FRAGMENTED
					}
				}
				BEL = {
					if = {
						limit = { has_game_rule = { rule = ger_fragmentation_status option = DEFAULT } }
						485 = { add_core_of = GER set_demilitarized_zone = yes }
						release = GER
					}
					else_if = {
						limit = { has_game_rule = { rule = ger_fragmentation_status option = GER_1870_FRAGMENTED } }
						release = PRE
					}
					else = {
						release = RHN
					}
					release = BRU
					release = BRB
					release = LIM
					release = HNT
					release = NMR
					release = LEG
					release = FLA
					500 = { add_core_of = LUX }
					2368 = { add_core_of = LUX }
					release = LUX
				}
			}
			if = {
				limit = {
					has_game_rule = {
						rule = hol_fragmentation_status
						option = HOL_FRAGMENTED
					}
				}
				HOL = {
					release = BRB
					release = LIM
					release = FLA
					release = WFR
				}
			}
		}
	}

	# ROOT is capitulated country, FROM is winner
	on_capitulation = {
		effect = {
			if = {
				limit = {
					tag = CSA
					FROM = {
						OR = {
							tag = USA
							is_in_faction_with = USA
						}
					}
				}
				USA = {
					annex_country = { target = CSA } #cleaner than hoping that the peace conference AI will sort it out
				}
			}
		}
		effect = {
			if = { # Reducing the Crisisjaren idea to level 1 when capitulated (in case player didn't manage to finish the mainland industrial focuses), but still needs Liberation to remove it fully
				limit = {
					original_tag = HOL
					has_idea = HOL_de_crisisjaren_4
				}
				swap_ideas = {
					remove_idea = HOL_de_crisisjaren_4
					add_idea = HOL_de_crisisjaren_1
				}
			}
			if = {
				limit = {
					original_tag = HOL
					has_idea = HOL_de_crisisjaren_3
				}
				swap_ideas = {
					remove_idea = HOL_de_crisisjaren_3
					add_idea = HOL_de_crisisjaren_1
				}
			}
			if = {
				limit = {
					original_tag = HOL
					has_idea = HOL_de_crisisjaren_2
				}
				swap_ideas = {
					remove_idea = HOL_de_crisisjaren_2
					add_idea = HOL_de_crisisjaren_1
				}
			}
			if = { # Only possible if Abandon the Gold Standard hasn't been taken yet, this can be taken later so should be reduced to level 2 rather than 1
				limit = {
					original_tag = HOL
					has_idea = HOL_de_crisisjaren_5
				}
				swap_ideas = {
					remove_idea = HOL_de_crisisjaren_5
					add_idea = HOL_de_crisisjaren_2
				}
			}
			if = {
				limit = {
					tag = GER
					FROM = {
						tag = HOL
						has_completed_focus = HOL_wilhelminism
					}
				}
				HOL = { country_event = { id = mtg_netherlands.76 } }
			}
		}
	}

	#ROOT is winner #FROM is loser
	on_peaceconference_ended = {
		effect = {
			if = {
				limit = {
					original_tag = GER
					FROM = { original_tag = HOL }
				}
				remove_ideas = HOL_german_defectors_2
			}
			# USA 'civil war' ends
			if = {
				limit = {
					tag = CSA
					FROM = { original_tag = USA }
				}
				load_focus_tree = { tree = usa_focus keep_completed = no }
				unlock_national_focus = USA_reestablish_the_gold_standard
				complete_national_focus = USA_america_first
				unlock_national_focus = USA_ally_with_the_silver_shirts
				unlock_national_focus = USA_invite_foreign_support
			}
		}
	}

	#ROOT is new controller #FROM is old controller #FROM.FROM is state ID
	on_state_control_changed = {
		effect = {
			if = {
				limit = {
					original_tag = HOL
					has_completed_focus = HOL_wilhelminism
					FROM = {
						original_tag = GER
						has_government = fascism
						has_civil_war = no
					}
					FROM.FROM = {
						is_core_of = GER
					}
				}
				FROM.FROM = { 
					set_state_flag = HOL_german_states_kaiser
				}
				country_event = { id = mtg_netherlands.73 }
			}
		}
	}

	on_nuke_drop = {
		effect = {			
			if = {
				limit = {
					tag = USA
					FROM = {
						state = 16
					}
				}
				set_country_flag = achievement_team_america
			}
		}
	}

	# FROM is the sinker, ROOT is the owner of the ship being sunk
	on_pride_of_the_fleet_sunk = {
		effect = {
			if = {
				limit = {
					tag = ENG
				}
				FROM = { set_country_flag = achievements_pride_and_extreme_prejudice }
			}
		}
	}

	on_leave_faction = {
		effect = {
			if = {
				limit = { 
					original_tag = HOL
					has_country_flag = HOL_joined_germany_flag
				}
				FROM = {
					create_wargoal = {
						type = take_state_focus
						target = ROOT
						generator = { 2344 }
					}
				}
			}
		}
	}

	# ROOT is the new faction leader FROM is the old faction leader
	on_assume_faction_leadership = {
		effect = {
			if = {
				limit = {
					FROM = {
						OR = {
							tag = GER
							tag = ENG
							tag = SOV
						}
					}
					NOT = {
						OR = {
							tag = USA
							tag = ENG
							tag = GER
							tag = ITA
							tag = FRA
							tag = SOV
						}
					}
				}
				set_country_flag = assuming_direct_control_achievement_flag
			}
		}
	}
}
